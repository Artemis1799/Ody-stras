<aside class="sidebar">
  <div class="sidebar-header">
    <h3>Points</h3>
    <div class="header-buttons">
      <button 
        type="button" 
        class="export-button"
        (click)="openExportModal()"
        title="Exporter les donn√©es"
      >
        <span class="pi pi-upload"></span>
      </button>
      <button 
        type="button" 
        class="equipment-button"
        (click)="openEquipmentManager()"
        title="G√©rer les √©quipements"
      >
        <span class="pi pi-cog"></span>
      </button>
    </div>
  </div>
  
  <div class="search-box">
    <input 
      type="text" 
      placeholder="Rechercher un lieu..." 
      [(ngModel)]="searchQuery"
      (ngModelChange)="onSearch()"
      (keyup.enter)="searchResults.length > 0 && goToLocation(searchResults[0])"
    />
    <button (click)="onSearch()">üîç</button>
  </div>
  
  <!-- Search results autocomplete -->
  <div class="search-results" *ngIf="searchResults.length > 0">
    <div 
      *ngFor="let result of searchResults" 
      class="result-item"
      (click)="goToLocation(result)"
    >
      {{ result.display_name }}
    </div>
  </div>

  <div *ngIf="points.length === 0 && !isLoading && !errorMessage" class="empty-state">
    Aucun point disponible
  </div>
  
  <div *ngIf="isLoading" class="loading">
    Chargement...
  </div>
  
  <div *ngIf="errorMessage" class="error">
    {{ errorMessage }}
  </div>
  
  <div 
    cdkDropList 
    class="points-list"
    (cdkDropListDropped)="onDrop($event)"
    *ngIf="!isLoading && !errorMessage"
  >
    <div 
      *ngFor="let point of points; let i = index" 
      class="point-item"
      [class.selected]="selectedPoint?.uuid === point.uuid"
      cdkDrag
      (click)="onPointClick(point)"
    >
      <div class="point-drag-handle" cdkDragHandle>
        <span class="drag-icon">‚ò∞</span>
      </div>
      <div class="point-content">
        <span class="point-order">{{ point.order }}</span>
        <span class="point-name">{{ getPointDisplayName(point) }}</span>
      </div>
      <div class="point-status" [class.valid]="point.isValid" [class.invalid]="!point.isValid">
        {{ point.isValid ? '‚úì' : '‚úó' }}
      </div>
    </div>
  </div>
  
  <button class="export-btn" (click)="openExport()">Exporter</button>
</aside>

<!-- Modal QR Code -->
<div class="modal-overlay" *ngIf="showQRModal" (click)="closeExportModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Exporter les donn√©es</h2>
      <button class="close-button" (click)="closeExportModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p class="instructions">Scannez ce QR code avec votre t√©l√©phone pour envoyer les donn√©es</p>
      <div class="qr-container">
        <img [src]="qrCodeDataUrl" alt="QR Code" *ngIf="qrCodeDataUrl" />
      </div>
      <p class="url-info">{{ wsUrl }}</p>
      <p class="status-info">‚úÖ Serveur WebSocket en attente de connexion...</p>
    </div>
  </div>
</div>
@if (showExportPopup) {
  <app-export-popup (close)="closeExport()"></app-export-popup>
}
