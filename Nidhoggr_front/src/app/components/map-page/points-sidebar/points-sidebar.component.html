<aside class="sidebar">
  <div class="search-box">
    <input
      type="text"
      placeholder="Rechercher un lieu..."
      [(ngModel)]="searchQuery"
      (ngModelChange)="onSearch()"
      (keyup.enter)="searchResults.length > 0 && goToLocation(searchResults[0])"
    />
  </div>

  <!-- Search results autocomplete -->
  <div class="search-results" *ngIf="searchResults.length > 0">
    <div *ngFor="let result of searchResults" class="result-item" (click)="goToLocation(result)">
      {{ result.display_name }}
    </div>
  </div>

  <!-- Event selector autocomplete -->
  <div class="event-selector">
    <p-autoComplete
      [(ngModel)]="selectedEventName"
      [suggestions]="filteredEvents"
      (completeMethod)="filterEvents($event)"
      (onSelect)="onEventSelect($event)"
      placeholder="SÃ©lectionner un Ã©vÃ©nement..."
      [dropdown]="true"
      [forceSelection]="true"
      [showEmptyMessage]="true"
      emptyMessage="Aucun Ã©vÃ©nement trouvÃ©"
    />
  </div>

  <!-- Points list component -->
  <app-points-list
    [points$]="points$"
    [selectedPointUuid]="selectedPointUuid"
    [isLoading]="isLoading"
    [errorMessage]="errorMessage"
    [emptyMessage]="emptyMessage"
    (pointClick)="onPointClick($event)"
  />

  <div class="bottom-buttons">
    @if (selectedEvent) {
    <button class="gantt-btn" (click)="openGantt()" [disabled]="!selectedEvent">
      ðŸ“Š Planning d'installation
    </button>
    <button class="edit-event-btn" (click)="openEventEdit()">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
      </svg>
      Modifier l'Ã©vÃ©nement
    </button>
    }

    <button class="equipment-btn" (click)="openEventCreate()">CrÃ©er un Ã©vÃ¨nement</button>
    <button
      class="export-btn"
      [class.disabled]="!selectedEvent"
      [disabled]="!selectedEvent"
      (click)="openExport()"
    >
      Exporter
    </button>
    <button class="import-btn" (click)="openImport()">Importer</button>
  </div>
</aside>

@if (showImportPopup) {
<app-import-popup (close)="closeImport()"></app-import-popup>
} @if (showExportPopup && selectedEvent) {
<app-export-popup [event]="selectedEvent" (close)="closeExport()"></app-export-popup>
} @if (showEventCreatePopup) {
<app-event-create-popup
  (close)="closeEventCreate()"
  (eventCreated)="onEventCreated($event)"
></app-event-create-popup>
} @if (showEventEditPopup && selectedEvent) {
<app-event-edit-popup
  [event]="selectedEvent"
  (close)="closeEventEdit()"
  (eventUpdated)="onEventUpdated($event)"
  (eventDeleted)="onEventDeleted($event)"
></app-event-edit-popup>
}

<app-timeline-popup
  [timelineItems]="timelineItems"
  [isVisible]="showTimeline"
  (pointHovered)="onTimelinePointHovered($event)"
  (pointHoverEnd)="onTimelinePointHoverEnd()"
  (closed)="closeTimeline()"
></app-timeline-popup>
