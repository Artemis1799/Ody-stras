<div class="teams-container">
  <div class="page-header">
    <div class="header-content">
      <div class="header-title">
        <div class="title-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="title-text">
          <h2>Équipes</h2>
        </div>
      </div>
    </div>
    <button class="btn-create" (click)="openCreateDialog()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
      Créer
    </button>
  </div>

  <!-- Loading state -->
  @if (isLoading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <span>Chargement...</span>
    </div>
  }

  <!-- Empty state -->
  @if (!isLoading() && teams().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <h3>Aucune équipe</h3>
      <p>Commencez par créer une équipe pour organiser vos membres</p>
      <button class="btn-create" (click)="openCreateDialog()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Créer une équipe
      </button>
    </div>
  }

  <!-- Teams grid -->
  @if (!isLoading() && teams().length > 0) {
    <div class="teams-grid">
      @for (team of teams(); track team.uuid) {
        <div class="team-card">
          <div class="team-header">
            <div class="team-number">{{ team.teamNumber || '#' }}</div>
            <div class="team-info">
              <div class="team-name">{{ team.teamName }}</div>
              @if (team.eventName) {
                <div class="team-event">{{ team.eventName }}</div>
              }
              <div class="team-members-count">{{ team.employees.length }} membre(s)</div>
            </div>
            <div class="team-actions">
              <button class="btn-icon btn-edit" (click)="openEditDialog(team)" title="Modifier">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
              </button>
              <button class="btn-icon btn-delete" (click)="confirmDelete(team)" title="Supprimer">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </button>
            </div>
          </div>
          
          @if (team.employees.length > 0) {
            <div class="team-members-list">
              @for (employee of team.employees; track employee.uuid) {
                <div class="member-chip">
                  <span class="member-avatar">{{ employee.firstName.charAt(0) }}{{ employee.lastName.charAt(0) }}</span>
                  <span class="member-name">{{ employee.firstName }} {{ employee.lastName }}</span>
                </div>
              }
            </div>
          } @else {
            <div class="no-members">
              <span class="pi pi-info-circle"></span>
              Aucun membre dans cette équipe
            </div>
          }
        </div>
      }
    </div>
  }
</div>

<!-- Create/Edit Dialog -->
@if (showDialog()) {
  <app-team-popup
    [isEditing]="isEditing()"
    [team]="currentTeam()"
    [allEmployees]="allEmployees()"
    [events]="events()"
    [(selectedEmployees)]="selectedEmployees"
    (save)="onTeamSave($event)"
    (close)="closeDialog()"
  ></app-team-popup>
}

<!-- Delete Confirmation Dialog -->
@if (showDeleteConfirm() && teamToDelete()) {
  <app-delete-popup
    title="Supprimer cette équipe"
    [itemName]="teamToDelete()!.teamName"
    warningMessage="Cette action est irréversible et supprimera également les associations avec les membres."
    (confirm)="deleteTeam()"
    (close)="cancelDelete()"
  ></app-delete-popup>
}
